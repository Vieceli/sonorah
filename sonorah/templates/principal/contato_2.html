{% extends "base.html" %}

{% block titulo %}Noticia - {{ noticia.titulo }}{% endblock %}

{% block extralinks %}
	{{ block.super }}

{% endblock %}
{% block extracss %}
	{{ block.super }}
{% endblock %}

{% block extrascripts %}
	{{ block.super }}
	
{% endblock %}

{% block js_ready %}
	{{ block.super }}
		$(function() {
		    var uuid = genUUID(); // id for this upload so we can fetch progress info.
		    // save the uuid with the element
		    $('#X-Progress-ID').val(uuid);
		    var options = {
		        dataType: "xml",
		        url: "/contato/get_upload_progress/?X-Progress-ID="+$('#X-Progress-ID').val(),
		        beforeSubmit: beforeSubmitHandler,
		        success: successHandler
		    };
		    $("#upload-file-form").ajaxForm(options);
		});

{% endblock js_ready %}


{% block extrajs %}
	{{ block.super }}
		function genUUID() {
		    var uuid = ""
		    for (var i=0; i < 32; i++) {
		        uuid += Math.floor(Math.random() * 16).toString(16);
		    }
		    return uuid;
		};
		
		// to update progress info
		function updateProgressInfo() {
		    var progress_url = "/contato/get_upload_progress/"; // ajax view serving progress info
		    var uuid = $('#X-Progress-ID').val();
		    $.getJSON(progress_url, {'X-Progress-ID': uuid}, function(data, status){
		        if (data) {
		            // uncomment to check in firebug
		            //console.log("uploaded: " + data.uploaded);
		            var progress = parseInt(data.uploaded) * 100 / parseInt(data.length);
		            $("#upload-progress-bar").progressBar(progress);
		            // trigger the next one after 1s
		            $("#upload-progress-bar").oneTime(1000, function() {
		                updateProgressInfo();
		            });
		        }
		    });
		};
		
		// pre-submit callback
		function beforeSubmitHandler(formData, jqForm, options) {
		    $("#upload-progress-bar").fadeIn();
		    $("#upload-progress-bar").progressBar({
		        boxImage: '{{ MEDIA_URL }}images/ajax-loader.gif',
		        barImage: '{{ MEDIA_URL }}images/ajax-loader.gif'
		    });
		    // trigger the 1st one
		    $("#upload-progress-bar").oneTime(1000, function(){
		        updateProgressInfo();
		    });
		
		    return true;
		};
		
		// post-submit callback
		function successHandler(responseText, statusText, xhr, $form) {
		    // delay and redirect the page to somewhere else
		    $("#upload-file-form").oneTime(1000, function() {
		        {% url tracefiles-root as tracefiles_root_url %}
		        window.location.replace("{{ tracefiles_root_url }}process/");
		    });
		
		    return true;
		};
{% endblock extrajs %}


{% block conteudo %}
<div id="topo" class="topo">
	{% block topo %}
	{% include "includes/topo.html" %}
	{% endblock topo %}
</div>
<div id="contato" class="contato">
	<form enctype="multipart/form-data" action="{% url contato %}" method="post" id="form_upload">
			{% csrf_token %}
			<div class="fieldWrapper">
				{{ contato_form.nome.errors }} <label for="id_nome" class="id_nome">*Nome: </label>
				{{ contato_form.nome }}
			</div>
			<div class="fieldWrapper">
				{{ contato_form.email.errors }} <label for="id_email" class="id_email">*E-Mail: </label>
				{{ contato_form.email }}
			</div>
			<div class="fieldWrapper">
				{{ contato_form.telefone.errors }} <label for="id_telefone" class="id_telefone">*Telefone: </label>
				{{ contato_form.telefone }}
			</div>
			<div class="fieldWrapper">
				{{ contato_form.arquivo.errors }} <label for="id_arquivo" class="id_arquivo">*Arquivo: </label>
				<!--<div class="fakeupload">
					<input type="text" name="fakeupload" />
				<input type="file" name="arquivo" id="arquivo_id" class="arquivo_id"  onchange="this.form.fakeupload.value = this.value;" /> -->
				{{ contato_form.arquivo }}
				<!--<input type="hidden" id="X-Progress-ID" name="X-Progress-ID" value=""/>
				<input type="hidden" id="id" name="id" value=""/>-->
			</div>
			<div class="fieldWrapper">
				{{ contato_form.mensagem.errors }} <label for="id_mensagem" class="id_mensagem">*Mensagem: </label>
				<div id="mensagem_contato" class="mensagem_contato">
					{{ contato_form.mensagem }}
				</div>
			</div>
			<input type="submit" value="Enviar"  class="enviar_contato"/>
		</form>
	<div id="efeito_enviar_contato" class="efeito_enviar_contato">
		<img src="/media/images/parceiros_efeito_enviar.png"/>
	</div>
	
</div>
<div id="detalhe_direito_contato" class="detalhe_direito_contato">
	<img src="/media/images/detalhe_direito_contato.png"/>
</div>
<div id="contato_direito" class="contato_direito">
	<p>Rua 89, Nº540 Setor Sul.</p>
	<p>Goiânia - GO | CEP: 74093-140</p>
    <p><img src="/media/images/telefone_contato.png"/> (62) 3281-0311</p>
    <p><img src="/media/images/email_contato.png"/> contato@sonorah.com</p>
    
    <div id="mapa_google" class="mapa_google">
    	<img src="http://maps.google.com/maps/api/staticmap?center=-16.694384, -49.257358&zoom=15&size=380x310&maptype=roadmap&sensor=true" />    
    </div>
    
    <form action="" method="post" id="upload-file-form" enctype="multipart/form-data">{% csrf_token %}
    <fieldset>
        <legend>Upload File'</legend>
        <input type="hidden" id="X-Progress-ID" name="X-Progress-ID" value=""/>
        
        <div>
            <div>
                {{ contato_form.as_p }}
            </div>
            <div><span id="upload-progress-bar"></span></div>
            <div class="submit-row">
                <input type="submit" value="Upload the file" class="default"/>
            </div>
        </div>
    </fieldset>
</form>
</div>


{% endblock conteudo %}	